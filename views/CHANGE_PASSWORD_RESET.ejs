<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cambiar Contraseña</title>
</head>
<body style="font-family: Arial, sans-serif; margin-top: 100px;; padding: 0; background-color: #f4f4f4;">
    <div style="max-width: 600px; margin: auto; background: #ffffff; padding: 0; border-radius: 5px; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);">
        <div style="background-color: #01133f; border-top-left-radius: 5px; border-top-right-radius: 5px; text-align: center;">
            <img src="https://raw.githubusercontent.com/Joabulla07/Proyecto2020-Python/refs/heads/gh-pages/gestionAr-banner.png" alt="Banner" style="width: 100%; height: auto; border-top-left-radius: 5px; border-top-right-radius: 5px;">
        </div>

        <div style="padding: 20px;">
            <h2 style="color: #333;">Cambiar Contrase&ntilde;a</h2>
            <p style="color: #555;">Por favor, ingrese su nueva contrase&ntilde;a a continuaci&oacute;n:</p>
            <form action="/api/user/resetPassword/<%= user_id %>" method="POST" onsubmit="return validatePassword()">
                <input type="hidden" name="user_id" value="<%= user_id %>">
                <label for="new_password">Nueva Contrase&ntilde;a:</label>
                <div style="display: flex; align-items: center; margin-top: 5px;">
                    <input type="password" id="new_password" name="new_password" required style="width: 70%; padding: 8px; border: 1px solid #ccc; border-radius: 5px; margin-right: 10px;" onkeyup="validatePassword()">
<!--                    <strong id="toggle-password" onclick="togglePassword()" style="cursor: pointer; color: #01133f;">Mostrar</strong>-->
                </div>

                <label for="confirm_password">Confirmar Contraseña:</label>
                <div style="display: flex; align-items: center; margin-top: 5px;">
                    <input type="password" id="confirm_password" name="confirm_password" required style="width: 70%; padding: 8px; border: 1px solid #ccc; border-radius: 5px; margin-right: 10px;" onkeyup="validatePassword()">
<!--                    <strong id="toggle-password" onclick="togglePassword()" style="cursor: pointer; color: #01133f;">Mostrar</strong>-->
                </div>
                <!-- Mensajes de error -->
                <div id="password-errors" style="color: red; margin: 10px 0; min-height: 20px;"></div>

                <!-- Indicador de fortaleza de contraseña -->
                <div id="password-strength" style="margin: 10px 0;"></div>

                <button type="submit" style="display: inline-block; padding: 10px 20px; margin: 20px 0; background-color: #01133f; color: white; text-decoration: none; border-radius: 5px; border: none; cursor: pointer;">Cambiar Contraseña</button>
            </form>
        </div>
    </div>

    <script>
        let passwordVisible = false; // Estado de visibilidad de la contraseña

        function togglePassword() {
            const passwordInput = document.getElementById('new_password');
            const confirm = document.getElementById('confirm_password');
            const toggleText = document.getElementById('toggle-password');
            passwordVisible = !passwordVisible; // Cambiar el estado

            // Cambiar el tipo de entrada y el texto
            passwordInput.setAttribute('type', passwordVisible ? 'text' : 'password');
            confirm.setAttribute('type', passwordVisible ? 'text' : 'password');
            toggleText.textContent = passwordVisible ? 'ocultar' : 'mostrar'; // Cambiar el texto
        }
    </script>

    <script>
        function validatePassword() {
            const password = document.getElementById('new_password').value;
            const confirmPassword = document.getElementById('confirm_password').value;
            const errorDiv = document.getElementById('password-errors');
            const submitBtn = document.querySelector('button[type="submit"]');
            const passwordStrength = document.getElementById('password-strength');

            // Validar coincidencia de contraseñas
            if (password !== confirmPassword) {
                errorDiv.innerHTML = 'Las contraseñas no coinciden';
                submitBtn.disabled = true;
                return false;
            }

            // Validar fortaleza de la contraseña
            const validations = {
                length: password.length >= 8,
                hasUpper: /[A-Z]/.test(password),
                hasLower: /[a-z]/.test(password),
                hasNumber: /[0-9]/.test(password),
                hasSpecial: /[!@#$%^&*(),.?":{}|<>]/.test(password)
            };

            const errors = [];
            if (!validations.length) errors.push("Mínimo 8 caracteres");
            if (!validations.hasUpper) errors.push("Al menos una mayúscula");
            if (!validations.hasLower) errors.push("Al menos una minúscula");
            if (!validations.hasNumber) errors.push("Al menos un número");
            if (!validations.hasSpecial) errors.push("Al menos un carácter especial");

            // Mostrar errores
            if (errors.length > 0) {
                errorDiv.innerHTML = 'Requisitos: ' + errors.join(', ');
                submitBtn.disabled = true;
                return false;
            }

            // Si pasa todas las validaciones
            errorDiv.innerHTML = '';
            submitBtn.disabled = false;
            return true;
        }

        // Validar en tiempo real
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.querySelector('form');
            const passwordInput = document.getElementById('new_password');
            const confirmPasswordInput = document.getElementById('confirm_password');

            [passwordInput, confirmPasswordInput].forEach(input => {
                input.addEventListener('input', validatePassword);
            });

            // Validar antes de enviar el formulario
            form.addEventListener('submit', function(e) {
                if (!validatePassword()) {
                    e.preventDefault();
                    return false;
                }
            });
        });
    </script>
</body>
</html>
